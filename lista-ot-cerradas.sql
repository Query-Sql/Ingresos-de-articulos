


--LISTA DE OT CERRADAS
SELECT TOP 500 C.REQ_NUMERO,C.REQ_PERSONAL_SOLIC,D.REQ_COMENTARIO1 ,C.REQ_ESTADO
from  INV_REQMATERIAL_CAB   AS  C INNER JOIN 
INV_REQMATERIAL_DET   AS  D  ON  C.REQ_NUMERO=D.REQ_NUMERO
WHERE  C.REQ_ESTADO='00'  AND REQ_COMENTARIO1  NOT IN (
SELECT  OF_COD FROM [011BDCOMUN].DBO.ORD_FAB  WHERE OF_ESTADO='ACTIVO')
AND D.REQ_COMENTARIO1!=' '
GROUP BY   C.REQ_NUMERO,C.REQ_PERSONAL_SOLIC,D.REQ_COMENTARIO1,C.REQ_ESTADO

/*
0000000314
0000000576
0000000894
0000000895
*/

--RESERVAS:
--CABECERA
SELECT * FROM [020BDCOMUN].DBO.RESERVA_CAB  WHERE  REQUERIMIENTO='0000000895'

--DETALLE
SELECT * FROM [020BDCOMUN].DBO.RESERVA_DET  WHERE  REQUERIMIENTO='0000000895'



--ANULAR  RQ DE MATERIALES CON OT LIQUIDADA:
--SOLO SE NECESITA ACTUALIZAR EL ESTADO DE LA CABECERA DEL RQ DE MATERIALES
UPDATE  [011BDCOMUN].DBO.INV_REQMATERIAL_CAB  
SET REQ_ESTADO='06' WHERE  REQ_NUMERO='0000000895'


--ANULAR  RERSERVA:
--CABECERA
--ACTUALIZAR EL ESTADO EN LA CABECERA
UPDATE  [020BDCOMUN].DBO.RESERVA_CAB
SET ESTADO='06' WHERE  REQUERIMIENTO='0000000895'

--DETALLE
--ACTUALIZAR EL EL CAMPO "CANT_PEND"  A 0
UPDATE  [020BDCOMUN].DBO.RESERVA_DET
SET CANT_PEND=0 WHERE REQUERIMIENTO='0000000895'